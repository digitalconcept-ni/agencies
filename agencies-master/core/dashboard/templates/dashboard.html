{% extends 'list2.html' %}
{% load static %}
{% block head_list_extra %}
    <script src="{% static 'lib/highcharts-9.1.1/highcharts.js' %}"></script>
    <script src="{% static 'lib/highcharts-9.1.1/modules/exporting.js' %}"></script>
    <script src="{% static 'lib/highcharts-9.1.1/modules/export-data.js' %}"></script>
    <script src="{% static 'lib/highcharts-9.1.1/modules/accessibility.js' %}"></script>

    {# Estilos del daschboard #}
    <link rel="stylesheet" href="{% static 'css/dash-style.css' %}">

    {# Funciondes del dashboard  #}

    <script src="{% static 'js/dashboard.js' %}"></script>

    {#    <link rel="stylesheet"#}
    {#          href="{% static 'lib/datatables-1.10.25/plugins/buttons-1.7.1/css/buttons.bootstrap.min.css' %}"/>#}
    {#    <script src="{% static 'lib/datatables-1.10.25/plugins/buttons-1.7.1/js/dataTables.buttons.min.js' %}"#}
    {#            type="text/javascript"></script>#}
    {#    <script src="{% static 'lib/datatables-1.10.25/plugins/jszip-2.5.0/jszip.min.js' %}"#}
    {#            type="text/javascript"></script>#}
    {#    <script src="{% static 'lib/datatables-1.10.25/plugins/pdfmake-0.1.36/pdfmake.min.js' %}"#}
    {#            type="text/javascript"></script>#}
    {#    <script src="{% static 'lib/datatables-1.10.25/plugins/pdfmake-0.1.36/vfs_fonts.js' %}"#}
    {#            type="text/javascript"></script>#}
    {#    <script src="{% static 'lib/datatables-1.10.25/plugins/buttons-1.7.1/js/buttons.html5.min.js' %}"#}
    {#            type="text/javascript"></script>#}

{% endblock %}

{% block body_content %}

    <section class="section dashboard">
        <div class="row">

            <!-- Clientes Card -->
            <div class="col-xxl-4 col-md-6">
                <div class="card info-card revenue-card pointer" id="programingClients">

                    <div class="filter">
                        <a class="icon" href="#" data-bs-toggle="dropdown"><i class="bi bi-three-dots"></i></a>
                        <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
                            <li class="dropdown-header text-start">
                                <h6>Filtro</h6>
                            </li>

                            <li><a class="dropdown-item" href="#">Hoy</a></li>
                            <li><a class="dropdown-item" href="#">Total</a></li>
                        </ul>
                    </div>

                    <div class="card-body">
                        <h5 class="card-title">Clientes <span>| Hoy</span></h5>

                        <div class="d-flex align-items-center">
                            <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                                <i class="bi bi-people"></i>
                            </div>
                            <div class="ps-3">
                                <h6 id="programing-clients">0</h6>
                                {#                                <span class="text-success small pt-1 fw-bold">12%</span>#}
                                {#                                <span class="text-muted small pt-2 ps-1">más</span>#}

                            </div>
                        </div>
                    </div>

                </div>
            </div><!-- End Clientes Card -->

            <!-- Ventas Card -->
            <div class="col-xxl-4 col-md-6">
                <div class="card info-card sales-card pointer" id="sale">

                    <div class="filter">
                        <a class="icon" href="#" data-bs-toggle="dropdown"><i class="bi bi-three-dots"></i></a>
                        <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
                            <li class="dropdown-header text-start">
                                <h6>Filtro</h6>
                            </li>

                            <li><a class="dropdown-item" href="#">Hoy</a></li>
                            <li><a class="dropdown-item" href="#">Esta semana</a></li>
                            <li><a class="dropdown-item" href="#">Este mes</a></li>
                        </ul>
                    </div>

                    <div class="card-body">
                        <h5 class="card-title">Ventas <span>| Hoy </span></h5>

                        <div class="d-flex align-items-center">
                            <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                                <i class="bi bi-receipt-cutoff"></i>
                            </div>
                            <div class="ps-3">
                                <h6 id="sales-today">0</h6>
                                {#                                <span class="text-success small pt-1 fw-bold">8%</span>#}
                                {#                                <span class="text-muted small pt-2 ps-1">más</span>#}

                            </div>
                        </div>
                    </div>

                </div>
            </div><!-- End Ventas Card -->

            <!-- Monto Card -->
            <div class="col-xxl-4 col-md-6">

                <div class="card info-card mount-card">

                    <div class="filter">
                        <a class="icon" href="#" data-bs-toggle="dropdown"><i class="bi bi-three-dots"></i></a>
                        <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
                            <li class="dropdown-header text-start">
                                <h6>Filtro</h6>
                            </li>

                            <li><a class="dropdown-item" href="#">Hoy</a></li>
                            <li><a class="dropdown-item" href="#">Este Mes</a></li>
                            <li><a class="dropdown-item" href="#">Este año</a></li>
                        </ul>
                    </div>

                    <div class="card-body">
                        <h5 class="card-title">Monto <span>| Hoy </span></h5>

                        <div class="d-flex align-items-center">
                            <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                                <i class="bi bi-cash-stack"></i>
                            </div>
                            <div class="ps-3">
                                <h6 id="amount">0</h6>
                                {#                                <span class="text-danger small pt-1 fw-bold">12%</span> <span#}
                                {#                                    class="text-muted small pt-2 ps-1">menos</span>#}

                            </div>
                        </div>

                    </div>
                </div>

            </div><!-- End Monto Card -->

            {% if request.user.is_superuser %}
                <!-- Products Card -->
                <div class="col-xxl-4 col-md-6">

                    <div class="card info-card all-box-card pointer" id="pro">

                        <div class="card-body">
                            <h5 class="card-title">Productos</h5>

                            <div class="d-flex align-items-center">
                                <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                                    <i class="bi bi-basket"></i>
                                </div>
                                <div class="ps-3">
                                    <h6 id="products">0</h6>
                                    {#                                <span class="text-danger small pt-1 fw-bold">12%</span>#}
                                    {#                                <span#}
                                    {#                                        class="text-muted small pt-2 ps-1">menos</span>#}

                                </div>
                            </div>

                        </div>
                    </div>

                </div><!-- End Products Card -->

            {% endif %}

            <!-- Low Products Card -->
            <div class="col-xxl-4 col-md-6">

                <div class="card info-card low-products-card pointer" id="lower">

                    <div class="card-body">
                        <h5 class="card-title">Productos escasos </h5>

                        <div class="d-flex align-items-center">
                            <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                                <i class="bi bi-box-arrow-down"></i>
                            </div>
                            <div class="ps-3">
                                <h6 id="lower-inventory">0</h6>
                                {#                                <span class="text-danger small pt-1 fw-bold">12%</span>#}
                                {#                                <span#}
                                {#                                        class="text-muted small pt-2 ps-1">menos</span>#}

                            </div>
                        </div>

                    </div>
                </div>

            </div><!-- End low products Card -->

            <!-- Pending invoices Card -->
            <div class="col-xxl-4 col-md-6">

                <div class="card info-card pending-invoice-card pointer" id="pending-invoices">

                    <div class="card-body">
                        <h5 class="card-title">Facturas pendientes</h5>

                        <div class="d-flex align-items-center">
                            <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                                <i class="bi bi-calendar2-event"></i>
                            </div>
                            <div class="ps-3">
                                <h6 id="applied-credit">0</h6>
                            </div>
                        </div>

                    </div>
                </div>

            </div><!-- End Pending invoices Card -->

        </div>
    </section>


    {#    ELIMINACION PENDIENTE DE UI LEGACY #}

    {#    <div class="container">#}
    {#        <div class="row mb-3">#}
    {##}
    {#            <div class="col-md-3 col-sm-6 col-12">#}
    {#                <div class="info-box bg-gradient-secondary shadow" id="programingClients">#}
    {#                    <span class="info-box-icon"><i class="fa fa-user-friends"></i></span>#}
    {#                    <div class="info-box-content">#}
    {#                        <span class="info-box-text">Clientes Programados</span>#}
    {#                        <h3 class="info-box-number" id="programing-clients">0</h3>#}
    {#                    </div>#}
    {#                </div>#}
    {#            </div>#}
    {##}
    {#            <div class="col-md-3 col-sm-6 col-12">#}
    {#                <div class="info-box bg-olive shadow-lg" id="sale">#}
    {#                    <span class="info-box-icon"><i class="fa fa-file-alt"></i></span>#}
    {#                    <div class="info-box-content">#}
    {#                        <span class="info-box-text">Ventas</span>#}
    {#                        <h3 class="info-box-number" id="sales-today">0</h3>#}
    {#                    </div>#}
    {#                </div>#}
    {#            </div>#}
    {# //END FIRST #}
    {##}
    {#            <div class="col-md-3 col-sm-6 col-12">#}
    {#                <div class="info-box bg-gradient-success shadow">#}
    {#                    <span class="info-box-icon"><i class="fa fa-money-bill-wave"></i></span>#}
    {#                    <div class="info-box-content">#}
    {#                        <span class="info-box-text">Total ventas</span>#}
    {#                        <h3 class="info-box-number" id="sales">0</h3>#}
    {#                    </div>#}
    {#                </div>#}
    {#            </div>#}
    {# //END SECOND #}
    {##}
    {#            {% if request.user.is_superuser %}#}
    {##}
    {#                <div class="col-md-3 col-sm-6 col-12">#}
    {#                    <div class="info-box bg-gradient-info products shadow" id="pro">#}
    {#                        <span class="info-box-icon"><i class="fa fa-barcode"></i></span>#}
    {#                        <div class="info-box-content">#}
    {#                            <span class="info-box-text">Productos</span>#}
    {#                            <h3 class="info-box-number" id="products">0</h3>#}
    {#                        </div>#}
    {#                    </div>#}
    {#                </div>#}
    {# //END THIRD #}
    {##}
    {#                <div class="col-md-3 col-sm-6 col-12">#}
    {#                    <a href="{{ clients_url }}">#}
    {#                        <div class="info-box bg-gradient-lightblue products shadow">#}
    {#                            <span class="info-box-icon"><i class="fa fa-users"></i></span>#}
    {#                            <div class="info-box-content">#}
    {#                                <span class="info-box-text">Clientes</span>#}
    {#                                <h3 class="info-box-number" id="clients">0</h3>#}
    {#                            </div>#}
    {#                        </div>#}
    {#                    </a>#}
    {#                </div>#}
    {# //END FOUR #}
    {#            {% endif %}#}
    {##}
    {#            <div class="col-md-3 col-sm-6 col-12" id="lower">#}
    {#                <div class="info-box bg-gradient-danger products shadow">#}
    {#                    <span class="info-box-icon"><i class="fa fa-arrow-down"></i></span>#}
    {#                    <div class="info-box-content">#}
    {#                        <span class="info-box-text">Productos poco inventario</span>#}
    {#                        <h3 class="info-box-number" id="lower-inventory">0</h3>#}
    {#                    </div>#}
    {#                </div>#}
    {#            </div>#}
    {##}
    {# APPLIED CREDIT #}
    {##}
    {#            <div class="col-md-3 col-sm-6 col-12" id="pending-invoices">#}
    {#                <div class="info-box bg-gradient-navy products shadow">#}
    {#                    <span class="info-box-icon"><i class="fa fa-file-alt"></i></span>#}
    {#                    <div class="info-box-content">#}
    {#                        <span class="info-box-text">Facturas pendientes</span>#}
    {#                        <h3 class="info-box-number" id="applied-credit">0</h3>#}
    {#                    </div>#}
    {#                </div>#}
    {#            </div>#}
    {#        </div>#}
    {##}
    {#    </div>#}

    {#   END BLOCK ELIMINACION PENDIENTE DE UI LEGACY #}


    {#    /////////////////////#}

    {% if request.user.is_superuser %}
        <div class="container">
            <div class="row">
                {# PRODUCTIONS CARD  #}
                <div class="col-md-12 col-lg-6">
                    <div class="card">

                        <div class="card-header border-0">
                            <h3 class="card-title">Detalle de Operaciones</h3>
                        </div>
                        <div class="card-body">
                            <a href="{% url 'production_list' %}">

                                <div class="d-flex justify-content-between align-items-center border-bottom mb-3">
                                    <p class="text-warning text-xl">
                                        <i class="bi bi-cone-striped"></i>
                                    </p>
                                    <p class="d-flex flex-column text-right">
                        <span class="font-weight-bold" id="process-lot">
                          0
                        </span>
                                        <span class="text-muted">PRODUCCIÓN EN PROCESO</span>
                                    </p>
                                </div>

                                <div class="d-flex justify-content-between align-items-center border-bottom mb-3">
                                    <p class="text-success text-xl">
                                        <i class="bi bi-calendar-check"></i>
                                    </p>
                                    <p class="d-flex flex-column text-right">
                        <span class="font-weight-bold" id="finaly-lot">
                        0
                        </span>
                                        <span class="text-muted">PRODUCCIÓN FINALIZADA</span>
                                    </p>
                                </div>

                                <div class="d-flex justify-content-between align-items-center mb-0">
                                    <p class="text-secondary text-xl">
                                        <i class="bi bi-calendar3"></i>
                                    </p>
                                    <p class="d-flex flex-column text-right">
                        <span class="font-weight-bold" id="total-lot">
                            0
                        </span>
                                        <span class="text-muted">TOTAL PRODUCCIONES</span>
                                    </p>
                                </div>
                            </a>

                        </div>
                    </div>
                </div>
                {#    // END CARDS INFORMTION#}

                <div class="col-md-12 col-lg-6">
                    <div class="card">
                        <div class="card-header border-0">
                            <h3 class="card-title">Productos más vendidos hoy</h3>
                        </div>

                        <div class="card-body table-responsive p-0">
                            <table class="table table-striped table-valign-middle" id="tableDashProductSold">
                                <thead>
                                <tr id="trow" rel="rowDash">
                                    <th scope="col">Nro</th>
                                    <th scope="col">Producto</th>
                                    <th scope="col">Cantidad</th>
                                </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>

                        </div>
                    </div>

                </div>

                <div class="col-md-12 col-lg-12">
                    <div id="container"></div>
                </div>
            </div>
            <br>
            <div class="row">
                <div class="col-lg-12">
                    <div id="container-pie"></div>
                </div>
            </div>
            <br>
        </div>

        {{ company }}
        {#    PART OF THE CODE FOR THE MODAL INFO FOR THE EPORDUCTS  WITH THE LOWER STOCK#}
        <script type="application/javascript">
            var year = new Date;
            let mesActual = new Intl.DateTimeFormat('es-ES', {month: 'long'}).format(year);

            var graphcolumn = Highcharts.chart('container', {
                chart: {
                    type: 'column'
                },
                title: {
                    text: `Reporte de ventas del año ${year.getFullYear()}`
                },
                subtitle: {
                    text: 'Reporte de columnas'
                },
                xAxis: {
                    categories: [
                        'Enero',
                        'Febrero',
                        'Marzo',
                        'Abril',
                        'Mayo',
                        'Junio',
                        'Julio',
                        'Agosto',
                        'Septiembre',
                        'Octubre',
                        'Noviembre',
                        'Diciembre'
                    ],
                    crosshair: true
                },
                yAxis: {
                    min: 0,
                    title: {
                        text: 'Valores C$'
                    }
                },
                tooltip: {
                    headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
                    pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
                        '<td style="padding:0"><b>{point.y:.1f} $</b></td></tr>',
                    footerFormat: '</table>',
                    shared: true,
                    useHTML: true
                },
                plotOptions: {
                    column: {
                        pointPadding: 0.2,
                        borderWidth: 0
                    }
                },
            });

            var graphpie = Highcharts.chart('container-pie', {
                chart: {
                    plotBackgroundColor: null,
                    plotBorderWidth: null,
                    plotShadow: false,
                    type: 'pie'
                },
                title: {
                    text: `Porcentaje de venta de productos por el mes de ${mesActual} del año ${year.getFullYear()}`
                },
                tooltip: {
                    pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
                },
                accessibility: {
                    point: {
                        valueSuffix: '%'
                    }
                },
                plotOptions: {
                    pie: {
                        allowPointSelect: true,
                        cursor: 'pointer',
                        dataLabels: {
                            enabled: true,
                            format: '<b>{point.name}</b>: {point.percentage:.1f} %'
                        }
                    }
                },
            });
            var graph = {
                g: []
            };

            graph.g = {{ graph|safe }}

            $(function () {
                graphcolumn.addSeries(graph.g[0]['graphcolumn'])
                graphpie.addSeries(graph.g[1]['graphpie'])
            });
        </script>
    {% endif %}
{% endblock %}